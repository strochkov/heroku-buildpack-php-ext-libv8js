#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

indent() {
  sed -u 's/^/       /'
}

echo "-----> Installing v8js php extension"

ENV_DIR=${3:-}
export_env_dir "$ENV_DIR" '^[A-Z_][A-Z0-9_]*$' '^(HOME|PATH|GIT_DIR|CPATH|CPPATH|LD_PRELOAD|LIBRARY_PATH|LD_LIBRARY_PATH|STACK|S3_URL|REQUEST_ID)$'

git clone https://github.com/FriendsOfPHP/pickle.git | indent
cd pickle
chmod +x bin/pickle
bin/pickle install v8js-0.1.3 | indent
echo "extension=v8js.so" >> /app/.heroku/php/etc/php/php.ini
echo "finished" | indent